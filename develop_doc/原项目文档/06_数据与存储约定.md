# 数据与存储约定（`~/.docetl/<namespace>/...`）

DocWrangler/后端默认以“命名空间（namespace）”隔离数据与 pipeline。命名空间目录位于：

- 默认：`~/.docetl/<namespace>/`
- 可覆盖：设置 `DOCETL_HOME_DIR`，则实际根目录为 `$DOCETL_HOME_DIR/.docetl/<namespace>/`

下面是目前仓库实现中出现的主要子目录约定。

## 1. 文件上传与文档

- 数据文件（JSON/CSV 上传后保存为 JSON）：
  - `~/.docetl/<namespace>/files/<filename>.json`
  - 由 `POST /fs/upload-file` 写入（`server/app/routes/filesystem.py`）
- 文档文件（原始 PDF/DOCX/...）：
  - `~/.docetl/<namespace>/documents/<original_filename>`
  - 由 `POST /fs/save-documents` 写入

## 2. Pipeline 配置（YAML）

- 配置文件：
  - `~/.docetl/<namespace>/pipelines/configs/<pipeline_name>.yaml`
  - 由 `POST /fs/write-pipeline-config` 写入
  - YAML 内容通常来自前端 `generatePipelineConfig(...)`

## 3. Pipeline 输出与中间结果

由 `generatePipelineConfig(...)` 生成的典型约定：

- 最终输出（pipeline.output.path）：
  - `~/.docetl/<namespace>/pipelines/outputs/<pipeline_name>.json`
- 中间结果目录（pipeline.output.intermediate_dir）：
  - `~/.docetl/<namespace>/pipelines/<pipeline_name>/intermediates/`
  - 每个 step/operation 的中间结果通常落在：
    - `.../intermediates/<step_name>/<operation_name>.json`

前端会据此推导 input/output 路径（用于 UI 展示、对比、分页读取）：

- 当前 op 输入：前一个 op 的中间产物；若不存在前序 op，则为 dataset path
- 当前 op 输出：当前 op 对应的中间产物路径

## 4. Pipeline “编辑态”存储（多 pipeline 切换/保存）

后端 pipeline store（供 UI 的 pipeline 列表/切换）：

- `~/.docetl/<namespace>/pipelines/store/<pipeline_id>.json`
  - 内容为 `PipelineRecord`（包含 name/namespace/state/created_at/updated_at/...）
  - state 为 UI 的序列化 snapshot（不等同于 DocETL YAML）

## 5. 缓存目录（执行/优化）

DocETL 还会维护缓存目录（用于优化与执行缓存等）：

- `~/.docetl/cache/<yaml_file_suffix>/...`（示例：`docetl/optimizer.py`）

> 提示：不同命名空间不会自动隔离 DocETL 的全局 cache（取决于 yaml_file_suffix/base_name 的构造方式）。

