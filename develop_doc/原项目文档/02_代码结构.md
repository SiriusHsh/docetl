# 代码结构（Repo Layout）

## 1. 顶层目录

- `docetl/`：核心 Python 包（算子、执行引擎、优化器、CLI、Python API）
- `server/app/`：FastAPI 后端（playground 执行、文件系统与 pipeline 存储 API）
- `website/`：DocWrangler 前端（Next.js + TypeScript）
- `docs/`：MkDocs 文档（含 playground 指南、算子说明、优化器说明等）
- `tests/`：pytest 测试（`tests/basic` 为快速 smoke）
- `example_data/`：示例数据
- `experiments/`：实验/研究向内容
- `docker-compose.yml` / `Dockerfile`：一键运行栈
- `pyproject.toml`：Python 包元数据、依赖、entry-points、ruff/mypy/pytest 配置
- `Makefile`：安装/测试/lint/启动 UI/启动 Docker 的便捷命令

## 2. 关键入口文件

### 2.1 CLI 入口

- `pyproject.toml` 中定义脚本：`docetl = "docetl.cli:app"`
- CLI 实现：`docetl/cli.py`
  - `docetl build <pipeline.yaml>`：优化（MOAR 或旧 v1）
  - `docetl run <pipeline.yaml>`：执行 pipeline
  - `docetl clear-cache`：清缓存

### 2.2 后端入口

- `server/app/main.py`：FastAPI `app` 创建、CORS、路由挂载、`/health`
- 主要路由：
  - `server/app/routes/pipeline.py`：执行（HTTP + WebSocket）、should_optimize 异步任务
  - `server/app/routes/filesystem.py`：命名空间、上传、读写、分页读、输出检查、文档服务
  - `server/app/routes/pipelines.py`：pipeline 元数据/状态 CRUD（供 UI 列表与切换）
  - `server/app/routes/convert.py`：文档转换（docling/azure/Modal 等路径）

### 2.3 前端入口

- Next.js App Router：
  - `website/src/app/layout.tsx`：全局 layout
  - `website/src/app/playground/page.tsx`：playground 页面入口
- UI 与后端交互：
  - `website/src/contexts/WebSocketContext.tsx`：WebSocket 连接 `/ws/run_pipeline/{namespace}`
  - `website/src/app/api/*`：Next.js Route Handlers（主要用于代理 FastAPI）
  - `website/src/app/api/utils.ts`：`generatePipelineConfig`（将 UI pipeline 状态 -> DocETL YAML）

## 3. 依赖与扩展点（从配置看）

- `pyproject.toml`：
  - `project.optional-dependencies.parsing/server`：按需安装解析/后端依赖
  - `project.entry-points."docetl.operation"`：算子插件入口（map/reduce/resolve/...）
  - `project.entry-points."docetl.parser"`：解析工具插件入口（txt/docx/pptx/azure/...）

